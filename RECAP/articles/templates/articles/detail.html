{% extends 'base.html' %}
{% load bootstrap4 %}

{% block body %}
  <div class="container">
    
      <h1>상세 페이지</h1>
      <p>번호: {{ article.pk }}</p>
      <p>제목: {{ article.title }}</p>
      <p>내용: {{ article.content }}</p>
      <p>작성자: {{ article.user }}</p>
      <p>생성 일자: {{ article.created_at|date:"SHORT_DATE_FORMAT"}}</p>
      <p>수정 일자: {{ article.updated_at }}</p>
    
      <a href="{% url 'articles:index' %}">목록보기</a>
      {% if article.user == request.user %}
      <a href="{% url 'articles:update' article.pk %}"> 수정하기 </a>
      <form action="{% url 'articles:delete' article.pk %}" method="POST">
        {% csrf_token %}
        <input type="submit" value="삭제">
      </form>
      {% endif %}
      <!-- <a href="{% url 'articles:delete' article.pk %}"> 삭제하기 </a> -->
    
      <hr>

      <h2>해시태그 목록</h2>
      <p>
        {% with hashtags=article.hashtags.all %}
        {% for hashtag in hashtags %}
        <strong>{{ hashtag }}</strong>
        {% endfor %}
        {% endwith %}
      </p>

      <hr>

      {% if request.user in article.like_users.all %}
        <a href="{% url 'articles:like' article.pk %}">좋아요 취소</a>
      {% else %}
        <a href="{% url 'articles:like' article.pk %}">좋아요</a>
      {% endif %}
      
      <p>좋아요: {{ article.like_users.count }}</p>
      <p>좋아요 목록:</p>
      <ul>
        {% with likers=article.like_users.all %}
          {% for u in likers %}
            <li>{{ u }}</li>
          {% endfor %}
        {% endwith %}
      </ul>

      <hr>

      <form action="{% url 'articles:commentCreate' article.pk %}" method="POST">
        {% csrf_token %}
        <!-- {% bootstrap_form form exclude='article' %} -->
        {% bootstrap_form form %}
        <input type="submit" value="댓글 달기">
      </form>

      <hr>

      <p><i>{{ comments | length }} 개의 댓글이 있습니다.</i></p>
      {% for comment in comments %}
        <p>
          {{ comment.content }}({{ comment.pk }}) by {{ comment.user.first_name }}

          {% if comment.user == request.user %}
          <form action="{% url 'articles:commentDelete' article.pk comment.pk %}" method="POST">
            {% csrf_token %}
            <input type="submit" value="댓글 삭제">
          </form>
          {% endif %}

        </p>
      {% empty %}
        <p>아직 댓글이 없습니다.</p>
      {% endfor %}

  </div>


{% endblock %}
